name: deploy server on cloud
on:
    push:
        branches:
            - dev
jobs:
    build:
            runs-on: ${{ matrix.os }}

            steps:
                -name: Checkout ğŸ›
                -uses: actions/checkout@dev

                - name: Setup node env ğŸ—
                  uses: actions/setup-node@v2.1.5
                  with:
                      node-version: ${{ matrix.node }}
                      check-latest: true

                - name: Cache node_modules ğŸ“¦
                  uses: actions/cache@v2.1.4
                  with:
                      path: ~/.npm
                      key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
                      restore-keys: |
                          ${{ runner.os }}-node-

                - name: Install dependencies ğŸ‘¨ğŸ»â€ğŸ’»
                  run: npm ci --prefer-offline --no-audit

                - name: Run linter ğŸ‘€
                  run: npm run lint

                - name: Run tests ğŸ§ª
                  run: npm run test
                
                - name: Deploy to Server  # ç¬¬å››æ­¥ï¼Œrsyncæ¨é€æ–‡ä»¶
                  uses: AEnterprise/rsync-deploy@v1.0  # ä½¿ç”¨åˆ«äººåŒ…è£…å¥½çš„æ­¥éª¤é•œåƒ
                  env:
                    DEPLOY_KEY: ${{ secrets.DEPLOY_KEY }}   # å¼•ç”¨é…ç½®ï¼ŒSSHç§é’¥
                    ARGS: -avz --delete --exclude='*.pyc'   # rsyncå‚æ•°ï¼Œæ’é™¤.pycæ–‡ä»¶
                    SERVER_PORT: '22'  # SSHç«¯å£
                    FOLDER: ./.nuxt/*  # è¦æ¨é€çš„æ–‡ä»¶å¤¹ï¼Œè·¯å¾„ç›¸å¯¹äºä»£ç ä»“åº“çš„æ ¹ç›®å½•
                    SERVER_IP: ${{ secrets.SSH_HOST }}  # å¼•ç”¨é…ç½®ï¼ŒæœåŠ¡å™¨çš„hoståï¼ˆIPæˆ–è€…åŸŸådomain.comï¼‰
                    USERNAME: ${{ secrets.SSH_USERNAME }}  # å¼•ç”¨é…ç½®ï¼ŒæœåŠ¡å™¨ç™»å½•å
                    SERVER_DESTINATION: /www/wwwroot/nuxt/   # éƒ¨ç½²åˆ°ç›®æ ‡æ–‡ä»¶å¤¹

            
